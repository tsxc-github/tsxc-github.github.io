const v="3.3.0",$={"Content-Type":"application/json"},h=e=>`${e.replace(/\/?$/,"/")}api/`,u=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`${t} failed with ${e.errno}: ${e.errmsg}`);return e},f=({serverURL:e,lang:t,paths:n,type:r,signal:a})=>fetch(`${h(e)}article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(r.join(","))}&lang=${t}`,{signal:a}).then((e=>e.json())).then((e=>u(e,"Get counter").data)),U=({serverURL:e,lang:t,path:n,type:r,action:a})=>fetch(`${h(e)}article?lang=${t}`,{method:"POST",headers:$,body:JSON.stringify({path:n,type:r,action:a})}).then((e=>e.json())).then((e=>u(e,"Update counter").data)),R=({serverURL:e,lang:t,paths:n,signal:r})=>f({serverURL:e,lang:t,paths:n,type:["time"],signal:r}),w=e=>U({...e,type:"time",action:"inc"}),L=(e="")=>e.replace(/\/$/u,""),b=e=>/^(https?:)?\/\//.test(e),d=e=>{const t=L(e);return b(t)?t:`https://${t}`},j=e=>{"AbortError"!==e.name&&console.error(e.message)},m=e=>{const{path:t}=e.dataset;return null!=t&&t.length?t:null},y=(e,t)=>{t.forEach(((t,n)=>{const r=e[n].time;"number"==typeof r&&(t.innerText=r.toString())}))},S=({serverURL:e,path:t=window.location.pathname,selector:n=".waline-pageview-count",update:r=!0,lang:a=navigator.language})=>{const o=new AbortController,l=Array.from(document.querySelectorAll(n)),s=e=>{const n=m(e);return null!==n&&t!==n},i=n=>R({serverURL:d(e),paths:n.map((e=>m(e)??t)),lang:a,signal:o.signal}).then((e=>y(e,n))).catch(j);if(r){const n=l.filter((e=>!s(e))),r=l.filter(s);w({serverURL:d(e),path:t,lang:a}).then((e=>y(e,n))),r.length&&i(r)}else i(l);return o.abort.bind(o)};export{S as pageviewCount,v as version};